<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Space Colouring Canvas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #fff;           /* White page background */
      touch-action: none;         /* Prevent default scrolling on touch */
    }

    /* -------------------- TOOLBAR -------------------- */
    #toolbar {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      background: rgba(0, 0, 0, 0.6); /* slightly more transparent */
      padding: 4px 6px;              /* smaller padding */
      border-radius: 6px;
      max-width: calc(100% - 20px);
      max-height: 40vh;              /* limit height to 40% of viewport */
      overflow-y: auto;              /* scroll if too tall */
      box-sizing: border-box;
      z-index: 10;
    }
    #toolbar * {
      font-family: 'Courier New', monospace;
      color: #fff;
      user-select: none;
      font-size: 0.85em; /* smaller font */
    }
    #toolbar label,
    #toolbar select,
    #toolbar button,
    #toolbar input[type="range"] {
      background: #444;
      border: 2px solid #fff;
      color: #fff;
      padding: 3px 5px;
      border-radius: 4px;
      cursor: pointer;
      touch-action: none;
    }
    #toolbar input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 70px; /* narrower slider */
      margin: 0 2px;
    }
    #toolbar input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
    }

    /* 20-color palette as small squares */
    #colorPalette {
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
      max-width: 180px;
    }
    .swatch {
      width: 18px;
      height: 18px;
      border: 2px solid #fff;
      border-radius: 3px;
      cursor: pointer;
    }
    .swatch.selected {
      outline: 2px solid #fff;
    }

    /* Loading indicator (small text) */
    #loadingIndicator {
      color: #ff0;
      font-size: 0.8em;
      margin-left: 4px;
    }

    /* -------------------- CANVAS -------------------- */
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fff;     /* White canvas background */
      touch-action: none;   /* Prevent scrolling while drawing */
    }
  </style>
</head>
<body>
  <!-- -------------------- TOOLBAR HTML -------------------- -->
  <div id="toolbar">
    <!-- 1) Template Selector -->
    <label>
      Template
      <select id="templatePicker">
        <option value="">-- choose image --</option>
        <option value="astronaut.png">Astronaut</option>
        <option value="rocket.png">Rocket</option>
        <option value="planet.png">Planet</option>
      </select>
    </label>
    <span id="loadingIndicator" style="display: none;">Loadingâ€¦</span>

    <!-- 2) Tool Buttons -->
    <button id="sprayBtn" disabled>Spray</button>
    <button id="brushBtn" disabled>Brush</button>
    <button id="shapeBtn" disabled>Shape</button>
    <button id="fillBtn" disabled>Fill</button>

    <!-- 3) Shape Picker -->
    <label>
      Shape
      <select id="shapePicker" disabled>
        <option value="circle">Circle</option>
        <option value="rect">Square</option>
      </select>
    </label>

    <!-- 4) Size Slider -->
    <label>
      Size
      <input type="range" id="sizePicker" min="5" max="100" value="30" disabled />
    </label>

    <!-- 5) 20-Color Palette -->
    <div id="colorPalette"></div>

    <!-- 6) Clear Button -->
    <button id="clearBtn" disabled>Clear</button>
  </div>

  <!-- -------------------- CANVAS HTML -------------------- -->
  <canvas id="canvas"></canvas>

  <script>
    // --- DOM ELEMENTS ---
    const canvas        = document.getElementById('canvas');
    const ctx           = canvas.getContext('2d');
    const tplPicker     = document.getElementById('templatePicker');
    const loadingText   = document.getElementById('loadingIndicator');
    const sprayBtn      = document.getElementById('sprayBtn');
    const brushBtn      = document.getElementById('brushBtn');
    const shapeBtn      = document.getElementById('shapeBtn');
    const fillBtn       = document.getElementById('fillBtn');
    const shapePicker   = document.getElementById('shapePicker');
    const sizePicker    = document.getElementById('sizePicker');
    const colorPalette  = document.getElementById('colorPalette');
    const clearBtn      = document.getElementById('clearBtn');

    // --- STATE VARIABLES ---
    let tool = 'spray';                // 'spray', 'brush', 'shape', 'fill'
    let isReady = true;                // disables tools while template loads
    let spraying = false;
    let brushDrawing = false;
    let lastPos = { x: 0, y: 0 };
    let currentColor = '#e6194b';      // default first color from palette

    // 20-color palette (modifiable hex values)
    const PALETTE = [
      '#e6194b','#3cb44b','#ffe119','#0082c8','#f58231',
      '#911eb4','#46f0f0','#f032e6','#d2f53c','#fabebe',
      '#008080','#e6beff','#aa6e28','#fffac8','#800000',
      '#aaffc3','#808000','#ffd8b1','#000080','#808080'
    ];

    // --- RESIZE CANVAS TO FILL WINDOW ---
    function resizeCanvas() {
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- BUILD COLOR PALETTE UI ---
    function buildPalette() {
      colorPalette.innerHTML = '';
      PALETTE.forEach(hex => {
        const sw = document.createElement('div');
        sw.classList.add('swatch');
        sw.style.backgroundColor = hex;
        if (hex === currentColor) sw.classList.add('selected');
        sw.addEventListener('click', () => {
          currentColor = hex;
          document.querySelectorAll('.swatch').forEach(s => s.classList.remove('selected'));
          sw.classList.add('selected');
        });
        colorPalette.appendChild(sw);
      });
    }
    buildPalette();

    // --- ENABLE / DISABLE TOOL UI ELEMENTS ---
    function setToolsEnabled(enabled) {
      [sprayBtn, brushBtn, shapeBtn, fillBtn, shapePicker, sizePicker
